<!DOCTYPE html>
<html>
<head>
    <title>Recreating the iOS 12.2 Wallet table view - Wilson Gramer’s Blog</title>

    <!-- Local styles -->
    <link rel="stylesheet" href="/styles/index.css">
    <link rel="stylesheet" href="/styles/hljs.css">

    <!-- Google fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Crimson+Pro:200,200i,600,600i|Fira+Code:200&display=swap">
</head>

<body>
    <div class="navbar">
        <a href="/">Wilson Gramer’s Blog</a>
    </div>

    <div class="post">
        <h1 class="title">Recreating the iOS 12.2 Wallet table view</h1>
        <p class="post-date">February 2, 2019</p>

        <div class="content">
            <p>The Wallet app was redesigned in iOS 12.2 with a fresher, more rounded look. This is most prominent in the table views scattered throughout the app — sections are rounded at the edges, similar how a detail table view looks on iPad. It looks really good everywhere, though, so let’s try to recreate it!</p>
<p>(TL;DR: <a href="https://gist.github.com/Wilsonator5000/67e1dd18cda7ab46d507a165d6d1bc42">Here’s the code.</a>)</p>
<p><img src="https://wgramer.files.wordpress.com/2019/02/img_4039.jpg?w=262&amp;h=566" alt="The iOS 12.2 Wallet app has a fresher, more rounded look"></p>
<p>I’ll be using my app <a href="http://superhomeworkapp.com/">SuperHomework</a> for this, but of course the code should work on any iOS app. I’m also using the iOS 12.2 beta (it should work on any iOS 12.x release, though) and Swift 4.2, the latest versions at the time of writing. I should also note that part of this implementation was taken from <a href="https://stackoverflow.com/a/19731571/5569234">this answer</a> and part of <a href="https://stackoverflow.com/a/48346782/5569234">this answer</a> on Stack Overflow.</p>
<p>Let’s get started! The first thing you’ll notice is how the section insets are increased in the Wallet app. I was experiencing issues setting <code>UITableView.contentInset</code> (which you would most likely want to do if you can get it working), so instead I just applied constraints to the left and right edges of the table view using <a href="https://github.com/SnapKit/SnapKit">SnapKit</a> and set the background color of the main view to that of the table view, giving a seamless look.</p>
<pre><code class="language-swift"><span class="hljs-keyword">self</span>.tableView.snp.remakeConstraints { make <span class="hljs-keyword">in</span>
    make.top.bottom.equalToSuperview()
    make.<span class="hljs-keyword">left</span>.<span class="hljs-keyword">right</span>.equalToSuperview().inset(<span class="hljs-number">16</span>)
}

<span class="hljs-keyword">self</span>.view.backgroundColor = <span class="hljs-keyword">self</span>.tableView.backgroundColor
</code></pre>
<p>Next, I created a <code>UITableView</code> extension to make the following implementation easier to apply to many different table views.</p>
<pre><code class="language-swift"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">UITableView</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">useRoundedSectionCorners</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// This will be called in `viewDidLoad()` to set up the table view</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">display</span><span class="hljs-params">(withRoundedSectionCorners cell: UITableViewCell, at indexPath: IndexPath)</span></span> {
        <span class="hljs-comment">// This will be called in `tableView(_:willDisplay:forRowAt:)` to render each cell</span>
    }
}
</code></pre>
<p>Inside the <code>useRoundedSectionCorners</code> method, I disabled the default separator line that runs through all of the cells and adds a section border — we’ll write our own separator in a bit. I also removed all of the excess padding around the edges of the table view that section headers/footers use to indent themselves.</p>
<pre><code class="language-swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">useRoundedSectionCorners</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">self</span>.separatorStyle = .<span class="hljs-keyword">none</span>
    <span class="hljs-keyword">self</span>.separatorInset = <span class="hljs-type">UIEdgeInsets</span>(top: <span class="hljs-number">0</span>, <span class="hljs-keyword">left</span>: <span class="hljs-keyword">self</span>.separatorInset.<span class="hljs-keyword">left</span>, bottom: <span class="hljs-number">0</span>, <span class="hljs-keyword">right</span>: <span class="hljs-number">0</span>)
}
</code></pre>
<p>Now let’s jump into <code>display(withRoundedSectionCorners:at:)</code>. The first thing we need to do is determine which modifications to make on the cell — that is, we don’t want to round the corners of a cell that’s in the middle of a section and whatnot. We can do that by passing the cell’s <code>indexPath</code> to the method and doing some math:</p>
<pre><code class="language-swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">display</span><span class="hljs-params">(withRoundedSectionCorners cell: UITableViewCell, at indexPath: IndexPath)</span></span> {
    <span class="hljs-comment">// Determine what modifications to make</span>
    <span class="hljs-keyword">let</span> numberOfRowsInSection = <span class="hljs-keyword">self</span>.numberOfRows(inSection: indexPath.section)

    <span class="hljs-keyword">var</span> shouldRoundTop = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> shouldRoundBottom = <span class="hljs-literal">false</span>

    <span class="hljs-keyword">if</span> indexPath.row == <span class="hljs-number">0</span> &amp;&amp; indexPath.row == numberOfRowsInSection - <span class="hljs-number">1</span> {
        <span class="hljs-comment">// the cell is the only one in the section</span>
        shouldRoundTop = <span class="hljs-literal">true</span>
        shouldRoundBottom = <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> indexPath.row == <span class="hljs-number">0</span> {
        <span class="hljs-comment">// the cell is the first in the section</span>
        shouldRoundTop = <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> indexPath.row == numberOfRowsInSection - <span class="hljs-number">1</span> {
        <span class="hljs-comment">// the cell is the last in the section</span>
        shouldRoundBottom = <span class="hljs-literal">true</span>
    }
}
</code></pre>
<p>Next, we’ll round the corners of the cell based on the calculations we just did. This is achieved using a <code>UIBezierPath</code> with our desired corner radius (12pt in this case to match the Wallet app).</p>
<pre><code class="language-swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">display</span><span class="hljs-params">(withRoundedSectionCorners cell: UITableViewCell, at indexPath: IndexPath)</span></span> {
    <span class="hljs-comment">// Determine what modifications to make</span>
    <span class="hljs-comment">// ...</span>
    
    <span class="hljs-comment">// Round corners if applicable</span>
    <span class="hljs-keyword">if</span> shouldRoundTop &amp;&amp; shouldRoundBottom {
        cell.layer.cornerRadius = <span class="hljs-number">10</span>
        cell.layer.masksToBounds = <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> shouldRoundTop || shouldRoundBottom {
        <span class="hljs-keyword">let</span> shape = <span class="hljs-type">CAShapeLayer</span>()
        <span class="hljs-keyword">let</span> rect = <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>, width: cell.bounds.width, height: cell.bounds.size.height)
        <span class="hljs-keyword">let</span> corners: <span class="hljs-type">UIRectCorner</span> = shouldRoundTop ? [.topLeft, .topRight] : [.bottomRight, .bottomLeft]

        shape.path = <span class="hljs-type">UIBezierPath</span>(roundedRect: rect, byRoundingCorners: corners, cornerRadii: <span class="hljs-type">CGSize</span>(width: <span class="hljs-number">12</span>, height: <span class="hljs-number">12</span>)).cgPath
        cell.layer.mask = shape
        cell.layer.masksToBounds = <span class="hljs-literal">true</span>
    }
}
</code></pre>
<p>Finally, we need to draw our own separator line for cells that are in the middle of a section, if the section has multiple rows.</p>
<pre><code class="language-swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">display</span><span class="hljs-params">(withRoundedSectionCorners cell: UITableViewCell, at indexPath: IndexPath)</span></span> {
    <span class="hljs-comment">// Determine what modifications to make</span>
    <span class="hljs-comment">// ...</span>
    
    <span class="hljs-comment">// Round corners if applicable</span>
    <span class="hljs-comment">// ...</span>
    
    <span class="hljs-comment">// Show separator if applicable</span>
    <span class="hljs-keyword">if</span> numberOfRowsInSection &gt; <span class="hljs-number">1</span> &amp;&amp; indexPath.row &lt; numberOfRowsInSection - <span class="hljs-number">1</span> {
        <span class="hljs-keyword">let</span> bottomBorder = <span class="hljs-type">CALayer</span>()
        bottomBorder.frame = <span class="hljs-type">CGRect</span>(x: <span class="hljs-keyword">self</span>.separatorInset.<span class="hljs-keyword">left</span>, y: cell.bounds.maxY - <span class="hljs-number">0.3</span>, width: cell.contentView.frame.size.width, height: <span class="hljs-number">0.3</span>)
        bottomBorder.backgroundColor = <span class="hljs-keyword">self</span>.separatorColor?.cgColor

        cell.contentView.layer.addSublayer(bottomBorder)
    }
}
</code></pre>
<p>Now we’re all set to implement this in our own table view! We can do so by calling <code>useRoundedSectionCorners()</code> on our table view in our view controller’s <code>viewDidLoad()</code>, and by calling <code>display(withRoundedSectionCorners:at:)</code> inside our table view delegate’s <code>tableView(_:willDisplay:forRowAt:)</code> method, like so:</p>
<pre><code class="language-swift"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.viewDidLoad()
    
    <span class="hljs-comment">// Add padding to the left and right sides</span>
    <span class="hljs-keyword">self</span>.tableView.snp.remakeConstraints { make <span class="hljs-keyword">in</span>
        make.top.bottom.equalToSuperview()
        make.<span class="hljs-keyword">left</span>.<span class="hljs-keyword">right</span>.equalToSuperview().inset(<span class="hljs-number">16</span>)
    }
    <span class="hljs-keyword">self</span>.view.backgroundColor = <span class="hljs-keyword">self</span>.tableView.backgroundColor
    
    <span class="hljs-comment">// Enable rounded section corners</span>
    <span class="hljs-keyword">self</span>.tableView.useRoundedSectionCorners()
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">tableView</span><span class="hljs-params">(<span class="hljs-number">_</span> tableView: UITableView, willDisplay cell: UITableViewCell, forRowAt indexPath: IndexPath)</span></span> {
    tableView.display(withRoundedSectionCorners: cell, at: indexPath)
}
</code></pre>
<p>…and here’s our final result!</p>
<p><img src="https://wgramer.files.wordpress.com/2019/02/img_4042.png?w=268&amp;h=581" alt="Our recreation of the Wallet app’s table view as shown in SuperHomework"></p>
<p>Thanks for reading! If you want to try this out in your app, download the full code <a href="https://gist.github.com/Wilsonator5000/67e1dd18cda7ab46d507a165d6d1bc42">here</a>.</p>

        </div>
    </div>
</body>
</html>
